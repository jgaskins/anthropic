<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Crystal Docs 1.10.1">
<meta name="crystal_docs.project_version" content="main-dev">
<meta name="crystal_docs.project_name" content="anthropic">



<link href="css/style.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="js/doc.js"></script>

  <meta name="repository-name" content="anthropic">
  <title>anthropic main-dev</title>
  <script type="text/javascript">
  CrystalDocs.base_path = "";
  </script>
</head>
<body>

<svg class="hidden">
  <symbol id="octicon-link" viewBox="0 0 16 16">
    <path fill="currentColor" fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
  </symbol>
</svg>
<input type="checkbox" id="sidebar-btn">
<label for="sidebar-btn" id="sidebar-btn-label">
  <svg class="open" xmlns="http://www.w3.org/2000/svg" height="2em" width="2em" viewBox="0 0 512 512"><title>Open Sidebar</title><path fill="currentColor" d="M80 96v64h352V96H80zm0 112v64h352v-64H80zm0 112v64h352v-64H80z"></path></svg>
  <svg class="close" xmlns="http://www.w3.org/2000/svg" width="2em" height="2em" viewBox="0 0 512 512"><title>Close Sidebar</title><path fill="currentColor" d="m118.6 73.4-45.2 45.2L210.7 256 73.4 393.4l45.2 45.2L256 301.3l137.4 137.3 45.2-45.2L301.3 256l137.3-137.4-45.2-45.2L256 210.7Z"></path></svg>
</label>
<div class="sidebar">
  <div class="sidebar-header">
    <div class="search-box">
      <input type="search" class="search-input" placeholder="Search..." spellcheck="false" aria-label="Search">
    </div>

    <div class="project-summary">
      <h1 class="project-name">
        <a href="index.html">
          anthropic
        </a>
      </h1>

      <span class="project-version">
        main-dev
      </span>
    </div>
  </div>

  <div class="search-results hidden">
    <ul class="search-list"></ul>
  </div>

  <div class="types-list">
    <ul>
  
  <li class="parent " data-id="anthropic/Anthropic" data-name="anthropic">
      <a href="Anthropic.html">Anthropic</a>
      
        <ul>
  
  <li class=" " data-id="anthropic/Anthropic/Client" data-name="anthropic::client">
      <a href="Anthropic/Client.html">Client</a>
      
    </li>
  
  <li class=" " data-id="anthropic/Anthropic/ContentBlockDelta" data-name="anthropic::contentblockdelta">
      <a href="Anthropic/ContentBlockDelta.html">ContentBlockDelta</a>
      
    </li>
  
  <li class="parent " data-id="anthropic/Anthropic/ContentBlockStart" data-name="anthropic::contentblockstart">
      <a href="Anthropic/ContentBlockStart.html">ContentBlockStart</a>
      
        <ul>
  
  <li class=" " data-id="anthropic/Anthropic/ContentBlockStart/ContentBlock" data-name="anthropic::contentblockstart::contentblock">
      <a href="Anthropic/ContentBlockStart/ContentBlock.html">ContentBlock</a>
      
    </li>
  
</ul>

      
    </li>
  
  <li class=" " data-id="anthropic/Anthropic/ContentBlockStop" data-name="anthropic::contentblockstop">
      <a href="Anthropic/ContentBlockStop.html">ContentBlockStop</a>
      
    </li>
  
  <li class="parent " data-id="anthropic/Anthropic/Error" data-name="anthropic::error">
      <a href="Anthropic/Error.html">Error</a>
      
        <ul>
  
  <li class=" " data-id="anthropic/Anthropic/Error/APIError" data-name="anthropic::error::apierror">
      <a href="Anthropic/Error/APIError.html">APIError</a>
      
    </li>
  
  <li class=" " data-id="anthropic/Anthropic/Error/AuthenticationError" data-name="anthropic::error::authenticationerror">
      <a href="Anthropic/Error/AuthenticationError.html">AuthenticationError</a>
      
    </li>
  
  <li class=" " data-id="anthropic/Anthropic/Error/InvalidRequestError" data-name="anthropic::error::invalidrequesterror">
      <a href="Anthropic/Error/InvalidRequestError.html">InvalidRequestError</a>
      
    </li>
  
  <li class=" " data-id="anthropic/Anthropic/Error/NotFoundError" data-name="anthropic::error::notfounderror">
      <a href="Anthropic/Error/NotFoundError.html">NotFoundError</a>
      
    </li>
  
  <li class=" " data-id="anthropic/Anthropic/Error/OverloadedError" data-name="anthropic::error::overloadederror">
      <a href="Anthropic/Error/OverloadedError.html">OverloadedError</a>
      
    </li>
  
  <li class=" " data-id="anthropic/Anthropic/Error/PermissionError" data-name="anthropic::error::permissionerror">
      <a href="Anthropic/Error/PermissionError.html">PermissionError</a>
      
    </li>
  
  <li class=" " data-id="anthropic/Anthropic/Error/RateLimitError" data-name="anthropic::error::ratelimiterror">
      <a href="Anthropic/Error/RateLimitError.html">RateLimitError</a>
      
    </li>
  
  <li class="parent " data-id="anthropic/Anthropic/Error/Response" data-name="anthropic::error::response">
      <a href="Anthropic/Error/Response.html">Response</a>
      
        <ul>
  
  <li class=" " data-id="anthropic/Anthropic/Error/Response/Error" data-name="anthropic::error::response::error">
      <a href="Anthropic/Error/Response/Error.html">Error</a>
      
    </li>
  
</ul>

      
    </li>
  
</ul>

      
    </li>
  
  <li class=" " data-id="anthropic/Anthropic/Event" data-name="anthropic::event">
      <a href="Anthropic/Event.html">Event</a>
      
    </li>
  
  <li class=" " data-id="anthropic/Anthropic/EventMessage" data-name="anthropic::eventmessage">
      <a href="Anthropic/EventMessage.html">EventMessage</a>
      
    </li>
  
  <li class=" " data-id="anthropic/Anthropic/EventSource" data-name="anthropic::eventsource">
      <a href="Anthropic/EventSource.html">EventSource</a>
      
    </li>
  
  <li class="parent " data-id="anthropic/Anthropic/GeneratedMessage" data-name="anthropic::generatedmessage">
      <a href="Anthropic/GeneratedMessage.html">GeneratedMessage</a>
      
        <ul>
  
  <li class="parent " data-id="anthropic/Anthropic/GeneratedMessage/Content" data-name="anthropic::generatedmessage::content">
      <a href="Anthropic/GeneratedMessage/Content.html">Content</a>
      
        <ul>
  
  <li class=" " data-id="anthropic/Anthropic/GeneratedMessage/Content/Type" data-name="anthropic::generatedmessage::content::type">
      <a href="Anthropic/GeneratedMessage/Content/Type.html">Type</a>
      
    </li>
  
</ul>

      
    </li>
  
  <li class=" " data-id="anthropic/Anthropic/GeneratedMessage/StopReason" data-name="anthropic::generatedmessage::stopreason">
      <a href="Anthropic/GeneratedMessage/StopReason.html">StopReason</a>
      
    </li>
  
  <li class=" " data-id="anthropic/Anthropic/GeneratedMessage/Text" data-name="anthropic::generatedmessage::text">
      <a href="Anthropic/GeneratedMessage/Text.html">Text</a>
      
    </li>
  
  <li class="parent " data-id="anthropic/Anthropic/GeneratedMessage/ToolUse" data-name="anthropic::generatedmessage::tooluse">
      <a href="Anthropic/GeneratedMessage/ToolUse.html">ToolUse</a>
      
        <ul>
  
  <li class=" " data-id="anthropic/Anthropic/GeneratedMessage/ToolUse/PossibleSchema" data-name="anthropic::generatedmessage::tooluse::possibleschema">
      <a href="Anthropic/GeneratedMessage/ToolUse/PossibleSchema.html">PossibleSchema</a>
      
    </li>
  
  <li class=" " data-id="anthropic/Anthropic/GeneratedMessage/ToolUse/Schema" data-name="anthropic::generatedmessage::tooluse::schema">
      <a href="Anthropic/GeneratedMessage/ToolUse/Schema.html">Schema</a>
      
    </li>
  
</ul>

      
    </li>
  
  <li class=" " data-id="anthropic/Anthropic/GeneratedMessage/Usage" data-name="anthropic::generatedmessage::usage">
      <a href="Anthropic/GeneratedMessage/Usage.html">Usage</a>
      
    </li>
  
</ul>

      
    </li>
  
  <li class="parent " data-id="anthropic/Anthropic/Image" data-name="anthropic::image">
      <a href="Anthropic/Image.html">Image</a>
      
        <ul>
  
  <li class="parent " data-id="anthropic/Anthropic/Image/Source" data-name="anthropic::image::source">
      <a href="Anthropic/Image/Source.html">Source</a>
      
        <ul>
  
  <li class=" " data-id="anthropic/Anthropic/Image/Source/MediaType" data-name="anthropic::image::source::mediatype">
      <a href="Anthropic/Image/Source/MediaType.html">MediaType</a>
      
    </li>
  
  <li class=" " data-id="anthropic/Anthropic/Image/Source/Type" data-name="anthropic::image::source::type">
      <a href="Anthropic/Image/Source/Type.html">Type</a>
      
    </li>
  
</ul>

      
    </li>
  
</ul>

      
    </li>
  
  <li class="parent " data-id="anthropic/Anthropic/Message" data-name="anthropic::message">
      <a href="Anthropic/Message.html">Message</a>
      
        <ul>
  
  <li class=" " data-id="anthropic/Anthropic/Message/Role" data-name="anthropic::message::role">
      <a href="Anthropic/Message/Role.html">Role</a>
      
    </li>
  
</ul>

      
    </li>
  
  <li class=" " data-id="anthropic/Anthropic/MessageContent" data-name="anthropic::messagecontent">
      <a href="Anthropic/MessageContent.html">MessageContent</a>
      
    </li>
  
  <li class="parent " data-id="anthropic/Anthropic/MessageDelta" data-name="anthropic::messagedelta">
      <a href="Anthropic/MessageDelta.html">MessageDelta</a>
      
        <ul>
  
  <li class=" " data-id="anthropic/Anthropic/MessageDelta/Delta" data-name="anthropic::messagedelta::delta">
      <a href="Anthropic/MessageDelta/Delta.html">Delta</a>
      
    </li>
  
  <li class=" " data-id="anthropic/Anthropic/MessageDelta/Usage" data-name="anthropic::messagedelta::usage">
      <a href="Anthropic/MessageDelta/Usage.html">Usage</a>
      
    </li>
  
</ul>

      
    </li>
  
  <li class="parent " data-id="anthropic/Anthropic/Messages" data-name="anthropic::messages">
      <a href="Anthropic/Messages.html">Messages</a>
      
        <ul>
  
  <li class=" " data-id="anthropic/Anthropic/Messages/Body" data-name="anthropic::messages::body">
      <a href="Anthropic/Messages/Body.html">Body</a>
      
    </li>
  
  <li class=" " data-id="anthropic/Anthropic/Messages/Query" data-name="anthropic::messages::query">
      <a href="Anthropic/Messages/Query.html">Query</a>
      
    </li>
  
  <li class=" " data-id="anthropic/Anthropic/Messages/Request" data-name="anthropic::messages::request">
      <a href="Anthropic/Messages/Request.html">Request</a>
      
    </li>
  
</ul>

      
    </li>
  
  <li class=" " data-id="anthropic/Anthropic/MessageStart" data-name="anthropic::messagestart">
      <a href="Anthropic/MessageStart.html">MessageStart</a>
      
    </li>
  
  <li class=" " data-id="anthropic/Anthropic/MessageStop" data-name="anthropic::messagestop">
      <a href="Anthropic/MessageStop.html">MessageStop</a>
      
    </li>
  
  <li class=" " data-id="anthropic/Anthropic/MessageStream" data-name="anthropic::messagestream">
      <a href="Anthropic/MessageStream.html">MessageStream</a>
      
    </li>
  
  <li class=" " data-id="anthropic/Anthropic/Model" data-name="anthropic::model">
      <a href="Anthropic/Model.html">Model</a>
      
    </li>
  
  <li class=" " data-id="anthropic/Anthropic/Ping" data-name="anthropic::ping">
      <a href="Anthropic/Ping.html">Ping</a>
      
    </li>
  
  <li class=" " data-id="anthropic/Anthropic/Resource" data-name="anthropic::resource">
      <a href="Anthropic/Resource.html">Resource</a>
      
    </li>
  
  <li class=" " data-id="anthropic/Anthropic/Text" data-name="anthropic::text">
      <a href="Anthropic/Text.html">Text</a>
      
    </li>
  
  <li class=" " data-id="anthropic/Anthropic/TextDelta" data-name="anthropic::textdelta">
      <a href="Anthropic/TextDelta.html">TextDelta</a>
      
    </li>
  
  <li class=" " data-id="anthropic/Anthropic/TextOrImageContent" data-name="anthropic::textorimagecontent">
      <a href="Anthropic/TextOrImageContent.html">TextOrImageContent</a>
      
    </li>
  
  <li class="parent " data-id="anthropic/Anthropic/Tool" data-name="anthropic::tool(t)">
      <a href="Anthropic/Tool.html">Tool</a>
      
        <ul>
  
  <li class=" " data-id="anthropic/Anthropic/Tool/Handler" data-name="anthropic::tool::handler">
      <a href="Anthropic/Tool/Handler.html">Handler</a>
      
    </li>
  
</ul>

      
    </li>
  
  <li class=" " data-id="anthropic/Anthropic/ToolResult" data-name="anthropic::toolresult">
      <a href="Anthropic/ToolResult.html">ToolResult</a>
      
    </li>
  
  <li class=" " data-id="anthropic/Anthropic/ToolUse" data-name="anthropic::tooluse">
      <a href="Anthropic/ToolUse.html">ToolUse</a>
      
    </li>
  
</ul>

      
    </li>
  
</ul>

  </div>
</div>


<div class="main-content">
<h1><a id="anthropic" class="anchor" href="#anthropic">  <svg class="octicon-link" aria-hidden="true">
    <use href="#octicon-link"/>
  </svg>
</a>anthropic</h1>
<p>Client for the Anthropic API. Supports tool use and running those tools automatically.</p>
<h2><a id="installation" class="anchor" href="#installation">
  <svg class="octicon-link" aria-hidden="true">
    <use href="#octicon-link"/>
  </svg>
</a>Installation</h2>
<ol>
<li>
<p>Add the dependency to your <code>shard.yml</code>:</p>
<pre><code class="language-yaml">dependencies:
  anthropic:
    github: jgaskins/anthropic</code></pre>
</li>
<li>
<p>Run <code>shards install</code></p>
</li>
</ol>
<h2><a id="usage" class="anchor" href="#usage">
  <svg class="octicon-link" aria-hidden="true">
    <use href="#octicon-link"/>
  </svg>
</a>Usage</h2>
<pre><code class="language-crystal"><span class="k">require</span> <span class="s">&quot;anthropic&quot;</span></code></pre>
<p>The main entrypoint is via the <code><a href="Anthropic/Client.html">Anthropic::Client</a></code>. You can instantiate it explicitly with an API key:</p>
<pre><code class="language-crystal">claude <span class="o">=</span> <span class="t">Anthropic</span><span class="t">::</span><span class="t">Client</span>.new(<span class="s">&quot;sk-and-api-03-asdfasdfasdf&quot;</span>)</code></pre>
<p>Or you can omit the API key to automatically read it from the <code>ANTHROPIC_API_KEY</code> environment variable:</p>
<pre><code class="language-crystal">claude <span class="o">=</span> <span class="t">Anthropic</span><span class="t">::</span><span class="t">Client</span>.new</code></pre>
<p>Next, use the <code>Anthropic::Messages#create</code> method to send your prompt:</p>
<pre><code class="language-crystal">response <span class="o">=</span> claude.messages.create(
  <span class="c"># Pass a string representing the model name, or retrieve the full model</span>
  <span class="c"># name via the shorthand with Anthropic.model_name.</span>
  model: <span class="t">Anthropic</span>.model_name(<span class="n">:sonnet</span>),

  <span class="c"># Define a system prompt if you want to give the AI a persona to use or some</span>
  <span class="c"># instructions on how to respond to the prompt.</span>
  system: <span class="s">&quot;You are an expert in the Crystal programming language&quot;</span>,

  <span class="c"># You can pass the full list of messages, including messages it gave you</span>
  <span class="c"># back.</span>
  messages: [
    <span class="t">Anthropic</span><span class="t">::</span><span class="t">Message</span>.new(<span class="s">&quot;What makes Crystal the best programming language?&quot;</span>)
  ],

  <span class="c"># The maximum number of tokens the AI will try to respond with. Keep this low</span>
  <span class="c"># if you&#39;re feeding untrusted prompts.</span>
  max_tokens: <span class="n">4096</span>,

  <span class="c"># A floating-point value between 0.0 and 1.0 representing how creative the</span>
  <span class="c"># response should be. Lower values (closer to 0.0) will be more deterministic</span>
  <span class="c"># and should be used for analytical prompts. Higher values (closer to 1.0)</span>
  <span class="c"># will be more stochastic.</span>
  temperature: <span class="n">0.5</span>,

  <span class="c"># You can optionally pass an `Array` of tools to give the client a way to run</span>
  <span class="c"># custom code in your app. See below for additional information on how to</span>
  <span class="c"># define those. The more tools you pass in with a request, the more tokens the</span>
  <span class="c"># request will use, so you should keep this to a reasonable size.</span>
  <span class="c">#</span>
  <span class="c"># By default, no tools are included.</span>
  tools: [
    <span class="t">GitHubUserLookup</span>,
    <span class="t">GoogleDriveSearch</span>.new(google_oauth_token),
  ],

  <span class="c"># Uncomment the following line to avoid automatically running the tool</span>
  <span class="c"># selected by the model.</span>
  <span class="c"># run_tools: false,</span>

  <span class="c"># Limit the token selection to the &quot;top k&quot; tokens. If you need this</span>
  <span class="c"># explanation, chances are you should use `temperature` instead. That&#39;s not a</span>
  <span class="c"># dig — I&#39;ve never used it myself.</span>
  <span class="c"># top_k: 10,</span>

  <span class="c"># P value for nucleus sampling. If you&#39;re dialing in your prompts with the</span>
  <span class="c"># `temperature` argument, you should ignore this one. I&#39;ve never used this</span>
  <span class="c"># one, either.</span>
  <span class="c"># top_p: 0.1234,</span>
)</code></pre>
<p>You can also pass images to the model:</p>
<pre><code class="language-crystal">puts claude
  .messages
  .create(
    <span class="c"># You should generally use the Haiku model when dealing with images since</span>
    <span class="c"># they tend to consume quite a few tokens.</span>
    model: <span class="t">Anthropic</span>.model_name(<span class="n">:haiku</span>),
    messages: [
      <span class="t">Anthropic</span><span class="t">::</span><span class="t">Message</span>.new(
        content: <span class="t">Array</span>(<span class="t">Anthropic</span><span class="t">::</span><span class="t">MessageContent</span>){
          <span class="c"># Images are base64-encoded and sent to the model</span>
          <span class="t">Anthropic</span><span class="t">::</span><span class="t">Image</span>.base64(<span class="n">:jpeg</span>, <span class="t">File</span>.read(<span class="s">&quot;/path/to/image.jpeg&quot;</span>)),
          <span class="t">Anthropic</span><span class="t">::</span><span class="t">Text</span>.new(<span class="s">&quot;Describe this image&quot;</span>),
        },
      ),
    ],
    max_tokens: <span class="n">4096</span>,
    <span class="c"># Using a more deterministic response about the image</span>
    temperature: <span class="n">0.1</span>,
  )</code></pre>
<h3><a id="defining-tools" class="anchor" href="#defining-tools">
  <svg class="octicon-link" aria-hidden="true">
    <use href="#octicon-link"/>
  </svg>
</a>Defining tools</h3>
<p>Tools are objects that the Anthropic models can use to invoke your code. You
can define them easily with a <code>struct</code> that inherits from
<code><a href="Anthropic/Tool/Handler.html">Anthropic::Tool::Handler</a></code>.</p>
<pre><code class="language-crystal"><span class="k">struct</span> <span class="t">GitHubUserLookup</span> <span class="o">&lt;</span> <span class="t">Anthropic</span><span class="t">::</span><span class="t">Tool</span><span class="t">::</span><span class="t">Handler</span>
  <span class="c"># Define any properties required for this tool as getters. Claude will</span>
  <span class="c"># provide them if it can based on the user&#39;s question.</span>

  <span class="c"># The username/login for the GitHub user, used to fetch the user from the</span>
  <span class="c"># GitHub API.</span>
  getter username : <span class="t">String</span>

  <span class="c"># This is the description that lets the model know when and how to use your</span>
  <span class="c"># code. It&#39;s basically the documentation the model will use. The more</span>
  <span class="c"># descriptive this is, the more confidence the model will have in invoking</span>
  <span class="c"># it, but it does consume tokens.</span>
  <span class="k">def</span> <span class="m">self</span>.description
    <span class="s">&lt;&lt;-EOF</span>
<span class="s">      Retrieves the GitHub user with the given username. The username may also
      be referred to as a &quot;login&quot;. The username can only contain letters,
      numbers, underscores, and dashes.

      The tool will return the current data about the GitHub user with that
      username. It should be used when the user asks about that particular
      GitHub user. It will not provide information about GitHub repositories
      or any issues, pull requests, commits, or other content on GitHub created
      by that GitHub user.
      EOF</span>
  <span class="k">end</span>

  <span class="c"># This is the method the client will use to invoke this tool. The return value</span>
  <span class="c"># of this method will be serialized as JSON and sent over the wire as the</span>
  <span class="c"># tool-use result</span>
  <span class="k">def</span> <span class="m">call</span>
    <span class="t">User</span>.from_json <span class="t">HTTP</span><span class="t">::</span><span class="t">Client</span>.get(<span class="t">URI</span>.parse(<span class="s">&quot;https://api.github.com/users/</span><span class="i">#{</span>username<span class="i">}</span><span class="s">&quot;</span>)).body
  <span class="k">end</span>

  <span class="c"># The definition for the value we want to send back to the model. Every</span>
  <span class="c"># property specified here will consume tokens, so only define getters that</span>
  <span class="c"># will provide useful context to the model.</span>
  <span class="k">struct</span> <span class="t">User</span>
    <span class="k">include</span> <span class="t">JSON</span><span class="t">::</span><span class="t">Serializable</span>

    getter login : <span class="t">String</span>
    getter name : <span class="t">String</span>
    getter company : <span class="t">String</span>?
    getter location : <span class="t">String</span>
    getter bio : <span class="t">String</span>?
    getter public_repos : <span class="t">Int64</span>
    getter public_gists : <span class="t">Int64</span>
    getter followers : <span class="t">Int64</span>
    getter following : <span class="t">Int64</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre>
<p>You can also define tools without inheriting from <code><a href="Anthropic/Tool/Handler.html">Anthropic::Tool::Handler</a></code>. That type simply implements the following API on the tool object (instance or type) being passed in:</p>
<ul>
<li><code>name : String</code></li>
<li><code>description : String</code></li>
<li><code>json_schema</code>, which returns a <code>to_json</code>-able object</li>
<li><code>parse</code>, which returns a <code>call</code>-able object which returns a <code>to_json</code>-able object</li>
</ul>
<p>Here is an example of a tool that searches a user's Google Drive (via the <a href="https://github.com/jgaskins/google"><code>jgaskins/google</code></a> shard) using the provided query. Claude will generate the query and pass it to the tool,</p>
<pre><code class="language-crystal"><span class="k">require</span> <span class="s">&quot;google&quot;</span>
<span class="k">require</span> <span class="s">&quot;google/drive&quot;</span>

record <span class="t">GoogleDriveSearch</span>, token : <span class="t">String</span> <span class="k">do</span>
  <span class="t">GOOGLE</span> <span class="o">=</span> <span class="t">Google</span><span class="t">::</span><span class="t">Client</span>.new(
    client_id: <span class="t">ENV</span>[<span class="s">&quot;GOOGLE_CLIENT_ID&quot;</span>],
    client_secret: <span class="t">ENV</span>[<span class="s">&quot;GOOGLE_CLIENT_SECRET&quot;</span>],
    redirect_uri: <span class="t">URI</span>.parse(<span class="s">&quot;https://example.com/oauth2/google&quot;</span>),
  )

  <span class="k">def</span> <span class="m">description</span>
    <span class="s">&quot;Search Google for a user&#39;s documents with the given search query. You must use the Google Drive API query string format.&quot;</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="m">name</span>
    <span class="s">&quot;GoogleDriveSearch&quot;</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="m">json_schema</span>
    <span class="c"># The `json_schema` class method is provided on all `JSON::Serializable`</span>
    <span class="c"># types by the `spider-gazelle/json-schema` shard.</span>
    <span class="t">Query</span>.json_schema
  <span class="k">end</span>

  <span class="k">def</span> <span class="m">parse</span>(json : <span class="t">String</span>)
    query <span class="o">=</span> <span class="t">Query</span>.from_json json
    query.search <span class="o">=</span> <span class="k">self</span>
    query
  <span class="k">end</span>

  <span class="k">def</span> <span class="m">call</span>(query : <span class="t">String</span>)
    files <span class="o">=</span> <span class="t">GOOGLE</span>
      .drive
      .files
      .list(
        token: token,
        q: <span class="s">&quot;(</span><span class="i">#{</span>query<span class="i">}</span><span class="s">) and mimeType contains &#39;application/vnd.google-apps&#39;&quot;</span>,
        limit: <span class="n">10</span>,
      )
      .to_a

    array <span class="o">=</span> <span class="t">Array</span>(<span class="t">FileInfo</span>).new(files.size)
    <span class="c"># Requires this PR to be released, or the equivalent monkeypatch:</span>
    <span class="c">#   https://github.com/crystal-lang/crystal/pull/14837</span>
    <span class="t">WaitGroup</span>.wait <span class="k">do</span> <span class="o">|</span>wg<span class="o">|</span>
      mutex <span class="o">=</span> <span class="t">Mutex</span>.new
      files.each <span class="k">do</span> <span class="o">|</span>file<span class="o">|</span>
        wg.spawn <span class="k">do</span>
          file_info <span class="o">=</span> <span class="t">FileInfo</span>.new(
            id: file.id,
            name: file.name,
            content: <span class="t">GOOGLE</span>.drive.files.export(file, <span class="s">&quot;text/plain&quot;</span>, token, <span class="o">&amp;</span>.gets_to_end),
            link: file.web_view_link,
          )

          mutex.synchronize <span class="k">do</span>
            array <span class="o">&lt;&lt;</span> file_info
          <span class="k">end</span>
        <span class="k">end</span>
      <span class="k">end</span>
    <span class="k">end</span>

    array
  <span class="k">end</span>

  <span class="k">struct</span> <span class="t">FileInfo</span>
    <span class="k">include</span> <span class="t">JSON</span><span class="t">::</span><span class="t">Serializable</span>

    getter id : <span class="t">String</span>
    getter name : <span class="t">String</span>
    getter content : <span class="t">String</span>
    getter link : <span class="t">String</span>

    <span class="k">def</span> <span class="m">initialize</span>(@id, @name, @content, @link)
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="k">struct</span> <span class="t">Query</span>
    <span class="k">include</span> <span class="t">JSON</span><span class="t">::</span><span class="t">Serializable</span>

    getter query : <span class="t">String</span>
    @[<span class="t">JSON</span><span class="t">::</span><span class="t">Field</span>(ignore: <span class="n">true</span>)]
    <span class="k">protected</span> property! search : <span class="t">GoogleDriveSearch</span>

    <span class="k">def</span> <span class="m">call</span>
      search.call(query)
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre>
<p>See the example code above to find out how to pass them to the model.</p>
<h2><a id="contributing" class="anchor" href="#contributing">
  <svg class="octicon-link" aria-hidden="true">
    <use href="#octicon-link"/>
  </svg>
</a>Contributing</h2>
<ol>
<li>Fork it (<a href="https://github.com/jgaskins/anthropic/fork">https://github.com/jgaskins/anthropic/fork</a>)</li>
<li>Create your feature branch (<code>git checkout -b my-new-feature</code>)</li>
<li>Commit your changes (<code>git commit -am 'Add some feature'</code>)</li>
<li>Push to the branch (<code>git push origin my-new-feature</code>)</li>
<li>Create a new Pull Request</li>
</ol>
<h2><a id="contributors" class="anchor" href="#contributors">
  <svg class="octicon-link" aria-hidden="true">
    <use href="#octicon-link"/>
  </svg>
</a>Contributors</h2>
<ul>
<li><a href="https://github.com/jgaskins">Jamie Gaskins</a> - creator and maintainer</li>
</ul>
</div>
</body>
</html>
